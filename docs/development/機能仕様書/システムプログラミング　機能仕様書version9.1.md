# システムプログラミングG2 機能仕様書

## 1. 基本情報

| 項目 | 内容 |
| :--- | :--- |
| **プロジェクト名** | 飲食店向け注文・決済Webアプリケーションシステム |
| **メンバー** | 蓬莱、星野、小野田 |
| **初版作成日** | 2025年11月7日（金） |

### 1.1. 改訂履歴

| 日付 | バージョン | 概要 |
| :--- | :--- | :--- |
| 2025/11/7 | 1.0 | 初版作成 |
| 2025/11/11 | 2.0 | 第2版作成 |
| 2025/11/12 | 2.1 | 第2版修正 |
| 2025/11/13 | 2.2 | 第2版修正 |
| 2025/11/14 | 3.0 | 第3版作成 |
| 2025/11/16 | 4.0 | 第4版作成 |
| 2025/11/22 | 5.0 | 第5版作成 |
| 2025/11/25 | 6.0 | 第6版作成 |
| 2025/11/28 | 6.1 | 第6版修正 |
| 2025/11/30 | 7.0 | 第7版作成 |
| 2025/12/01 | 7.1 | 第7版修正 |
| 2025/12/01 | 7.2 | 第7版修正 |
| 2025/12/03 | 7.3 | 第7版修正 |
| 2025/12/03 | 7.4 | 第7版修正 |
| 2025/12/03 | 7.5 | 第7版修正 |
| 2025/12/08 | 8.0 | 第8版作成 |
| 2025/12/11 | 9.0 | 第9版作成 |
| 2025/12/11 | 9.1 | 第9版修正 |
| 2025/12/11 | 9.2 | 第9版修正 |
| 2025/12/15 | 9.3 | 第9版修正 |

## 2. システム概要

本システムは、飲食店における注文および決済を行うためのWebアプリケーションシステムである。従業員（管理者）とお客さん（ユーザー）双方のシステムで構成される。

### 2.1. 前提条件・制約事項

*   決済手段は、QRコード決済のみを想定する（注文端末に表示されたQRコードをユーザー端末で読み取る方式）。
*   商品のカスタマイズ機能（大盛り・トッピング等）は行わない。
*   注文後のキャンセルは不可とする。
*   注文カゴでの数量変更は、誤操作防止のため、商品を一度削除してから再度選択する方式で行う。
*   会計での割り勘、テーブルの移動・合流は発生しないものとする。
*   日本標準時（世界標準時+9時間）を使用する。
*   子供のみの来店を許容しない。
*   営業時間は(11:00 ~ 22:00)(JST)を想定。

### 2.2. ペルソナ

| 端末名 | 利用者 | ペルソナ特性 |
| :--- | :--- | :--- |
| **注文・決済端末** | お客さん</br>（ユーザー）| 老若男女問わず、PCやタブレットに慣れていない人も含め、直感的に使えるシステムが必要である。 |
| **管理端末** | 従業員</br>（管理者） | PCやブラウザの操作にはある程度慣れているが、システムに関する知識はない人がほとんどである。 |
| **ユーザー端末** | ユーザー</br>（ユーザー） | 老若男女問わず、PCやタブレットに慣れていない人も含め、直感的に使えるシステムが必要である。 |

## 3. 用語一覧

### 3.1. 利用者・端末・場所

| 用語 | 概要・定義 |
| :--- | :--- |
| **お客様** | 店舗に来店されたお客様。<br>・大人：13歳以上<br>・子供：0から12歳 |
| **ユーザー** | 注文・決済を行うお客様。 |
| **管理者** | システム全体の運用・管理を行う従業員。 |
| **注文・決済端末** | ユーザーが注文・決済を行う画面。（タブレットを想定・店内のテーブルごとに端末）|
| **管理端末** | 管理者がシステムの運用・管理・分析結果等の閲覧を行う画面。（PCを想定・店舗の厨房等に設置）|
| **ユーザー端末** | ユーザーが決済を行う画面。（ユーザーのスマートフォン）|
| **店舗** | システムを導入している飲食店。 |
| **テーブル** | 店舗内の座席。4桁のテーブル番号（0000から9999）で管理される。 |

### 3.2. データ項目

| 用語 | 概要・定義 |
| :--- | :--- |
| **ユーザーID** | システム内でユーザーを一意に識別するためのID（UUID version4）。 |
| **管理者ID** | システム内で管理者を一意に識別するためのID（UUID version4）。 |
| **伝票ID** | 1組の来店客（1テーブルの1回の食事）を一意に識別するID（UUID version4）。 |
| **伝票項目ID** | 注文された個々の商品レコードを一意に識別するID（UUID version4）。 |
| **商品ID** | 商品を一意に識別するコード（例: DRINK0001）。カテゴリごとの連番などで構成。 |
| **セキュリティーコード** | 決済時に登録されたユーザーかを確認し、不正利用を防ぐための４桁の数字。（クレジットカード等と同様）<br>※３回間違えると、そのユーザーの決済機能が使えなくなる。<br>・新規登録時に設定後は、管理画面でも変更不可。|
| **残高** | ユーザーが入金して決済に利用することができる金額。<br>1アカウントあたりの残高上限：500,000円。 |
| **ポイント** | 会計時に100円で1ポイントをユーザーに付与する。1ポイント＝1円として決済時に利用可能。 |
| **入金** | ユーザーがユーザー端末を使って、残高に入金すること。<br>1回あたりの入金制限：100円から300,000円 |
| **会計** | 注文端末を使って、注文した内容の会計を行うこと。 |
| **決済** | ユーザー端末で行うQRコード決済のこと。（今回は、QRコード決済しか使えない。）|
| **注文カゴ** | ユーザーが選択した商品を一時的に保存するリスト。注文確定前の確認や注文取り消しに使用されるリスト。 |
| **カテゴリ** | 商品を分類するグループ<br>・カテゴリ名：メニュー画面上でお客さんに表示される名称。<br>・カテゴリコード：商品IDの接頭語になる分類用の英字。<br>・例：肉、サイドメニュー、ご飯・麺・スープ、ドリンク、デザート |
| **客層** | 来店客の構成タイプ。分析に使用される。<br>・**おひとり様**：大人1人<br>・**大人2人**：大人2人のみ<br>・**ファミリー**：大人1から2人 ＋ 子供1から7人<br>・**大人グループ**：大人3から8人<br>・**グループ**：大人3から7人 ＋ 子供1から5人|
| **個数** | 一つの選択ごとに注文カゴに追加することのできる最大数：8個。 |

## 4. 画面・UI機能

| 用語 | 概要・定義 |
| :--- | :--- |
| **初期設定画面** | 注文端末とテーブル番号を紐づけるための設定画面。|
| **人数選択画面** | 注文端末の初期状態。来店時に大人・子供の人数を入力する画面。 |
| **注文画面** | 注文端末において、カテゴリ（肉、ドリンク等）ごとの商品一覧と、注文状況 =「注文カゴ」の商品一覧を表示する注文端末のメイン画面。 |
| **数量選択画面** | 注文端末において、商品の数量を選択する画面。 |
| **注文履歴画面** | 注文端末において、カテゴリ（肉、ドリンク等）ごとの商品一覧と、注文状況 =「調理中」・「商品到着済み」の商品一覧を表示する画面。|
| **会計画面** | 注文端末において、ご注文内容の確認と、お支払方法の選択をする画面。 |
| **決済用QRコード表示画面** | 注文端末において、決済用のQRコードが表示される画面。 |
| **注文端末決済完了画面** |  注文端末において、決済が完了した際に表示される画面。 |
| **管理者ログイン画面** | 管理者端末において、ID・パスワードを用いて認証を行う画面。 |
| **管理者注文情報画面** | 管理者端末において、注文状況 =「調理中」・「商品到着」の注文をリアルタイムで一覧表示する画面。|
| **分析画面** |　管理者端末において、客層ごとの売れ筋商品ランキング（トップ5）を表示する画面。 |
| **ユーザー管理画面** | 管理者端末において、登録されている全ユーザーを一覧表示・ユーザー状況変更をする画面。|
| **商品一覧表示画面** | 管理者端末において、登録されている全商品を一覧表示する画面。|
| **商品編集フォーム画面** | 管理者端末において、商品の詳細情報を入力・更新する画面。 |
| **ユーザー新規登録画面** | ユーザー端末において、アカウント情報を登録する画面。|
| **ユーザーログイン画面** | ユーザー端末において、ログインを行う画面。|
| **ユーザーホーム画面** | ユーザー端末において、ログイン状態の時に表示するホーム画面。 |
| **QRコード読み取り画面** | ユーザー端末において、決済用QRコードを読み取る画面。 |
| **決済画面** | ユーザー端末において、使用するポイント数、支払い内容を確認する画面。 |
| **セキュリティコード入力画面** | ユーザー端末において、セキュリティコードを入力する画面。 |
| **ユーザー端末決済完了画面** | ユーザー端末において、決済が完了したに表示される画面。
| **入金画面** | ユーザー端末において、現在の決済残高を確認し、指定金額をチャージ（入金）するための画面。 |


## 5. 機能
### ユーザーが操作する機能（注文端末・ユーザー端末）
####  テーブル登録
>① 管理者は、注文端末で管理者名と管理者パスワード、テーブル番号を入力する。<br>
② システムは、入力された管理者名と管理者パスワードを用いて認証を行う。<br>
③ システムは、入力されたテーブル番号がすでに使われていないか確認して、テーブル番号と該当端末の紐付けを行う。<br>
④ 紐付けが完了することで、ユーザーが人数選択を可能な状態となる。
* 管理者認証機能：管理者は、入力した管理者名とパスワードを事前にシステム内で定めた固定値と照合され認証されると、テーブル番号と該当端末の紐付けを行うことができる。<br>
    * 管理者名：固定値
    * パスワード：固定値
* テーブル番号重複確認機能：システムは、管理者が入力したテーブル番号がすでに使われていないか確認して、テーブル番号と該当端末の紐付けを行う。<br>
    * テーブル番号：４桁の数字（0000~9999）
* 例外：認証失敗・入力不備・テーブル番号が重複している場合には、エラーメッセージを表示する。

#### 人数選択
>① ユーザーは、注文端末で大人と子供の人数を入力を行う。<br>
② 入力を完了することで、メニューの閲覧や注文、決済が可能な状態となる。
* 人数入力機能：ユーザーは、大人・子供それぞれの人数を入力する。<br>
    * 大人：１〜８人
    * 子供（〜12歳）：０〜７人
    * システムは、大人と子供の合計人数が、８人以上にならないようにする。
* 伝票ID発行機能：システムは、人数の入力を確定した後に伝票IDを発行し、セッションに保存する。

#### メニューの閲覧
>① ユーザーは、注文端末で該当カテゴリのボタンをタップすることで、そのカテゴリの商品を閲覧することができる。<br>
② ユーザーは、各商品の一覧をカテゴリごとに閲覧することができる。
* カテゴリ切り替え機能：システムは、商品をカテゴリごとに表示する。<br>
* 商品一覧表示機能：ユーザーは、画像・価格・商品名を一覧で閲覧することができる。

#### 注文
>① ユーザーは、注文端末でメニューの各商品をタップすることで、注文する商品の個数を選択する画面へと遷移する。<br>
② ユーザーは、注文する商品の個数を選択して、その商品を注文カゴに追加することができる。<br>
③ ユーザーは、注文する商品を注文カゴに入れた後、注文を確定させることで、店側に注文する商品を送信することができる。<br>
〇 ユーザーは、注文カゴに入った商品を、取り消すことができる。
##### 商品を追加
* 商品選択機能：ユーザーは、メニューの中から注文したい商品を選択できる。<br>
* 数量選択機能：ユーザーは、注文したい商品の個数を指定できる。<br>
* 注文カゴ追加機能：ユーザーは、個数を選択した商品を注文カゴに追加できる。<br>
##### 注文カゴを表示
* 金額計算・上限チェック機能：システムは、注文カゴに商品を追加後の合計金額（注文内合計金額＋注文済み合計金額を計算）を計算し、決済上限（300,000円）を超えないか確認する。<br>
* 注文カゴ一覧表示機能：ユーザーは、過去に注文された商品一覧を閲覧することができる<br>
* 合計金額計算機能：ユーザーは、合計金額（注文内合計金額＋注文済み合計金額）の計算し、注文画面で閲覧することができる。
* 注文カゴ商品取り消し機能：ユーザーは、注文かご内の商品を指定し、注文カゴの商品を削除することができる。
* 例外：合計金額が決済上限を超えている時には、注文端末上にエラーメッセージを表示する。
##### 注文
* 注文機能：ユーザーは、注文カゴの中にある注文を確定する。

#### 注文履歴
>① ユーザーは、注文した商品の詳細を閲覧することができる。
* 注文履歴表示機能：ユーザーは、注文履歴を閲覧することができる
* 合計金額計算機能：ユーザーは、合計金額（注文内合計金額＋注文済み合計金額）の計算し、注文画面で閲覧することができる。

#### 支払い・ポイントを貯める・ポイントの利用
>① ユーザーは、注文端末で注文内容の確認と支払い方法を選択する。<br>
② ユーザーは、注文端末上のQRコードを、ユーザー端末で読み取る。<br>
③ ユーザーは、ユーザー端末で金額を確認し、利用ポイントを指定する。<br>
④ ユーザーは、ユーザー端末でセキュリティコードを入力して決済を完了させる。
* QRコード生成・表示機能：システムは、伝票IDに基づいた決済用QRコードを生成し、画面に表示する。
* QRコード読み取り機能：ユーザーは、ユーザー端末でカメラを起動してQRコードをスキャンし、埋め込まれた伝票IDを読み取る。<br>
* ポイント利用入力機能：ユーザーは、利用可能なポイントのうち、支払いに充当するポイント数を入力する。<br>
* セキュリティコード認証機能：ユーザーは、セキュリティコードを入力し、本人確認を行った上で支払いが完了となる。<br>
* ポイント付与機能：システムは、決済完了時に支払い金額に応じ、100円ごとに1ポイントを付与する。
* ロック機能：ユーザーは、セキュリティコードを3回連続失敗でアカウントをロックアウトされる。
* 例外：残高不足、利用可能ポイント超過、セキュリティコードが間違っている場合には、エラーメッセージを表示する。

#### ユーザー登録
>① ユーザーは、ユーザー端末でユーザー名、ユーザーパスワード、セキュリティコードを入力することで、ユーザーアカウントを作成する。
* ユーザー新規登録入力機能：ユーザーは、ユーザー名、ユーザーパスワード、セキュリティコードを入力する。
* ユーザー名重複チェック機能：システムは、ユーザー名の重複がないか確認する。
* ユーザー登録機能：システムは、パスワードをハッシュ化し、ユーザー名、ユーザーパスワード、セキュリティコードを登録する。
* 例外：認証失敗、入力不備、ユーザー名・ユーザーパスワード・セキュリティコードが異なっている場合には、エラーメッセージを表示する。

#### ユーザーログイン
>① ユーザーは、ユーザー端末でユーザー名とユーザーパスワードを入力することで、ユーザー認証を行う。<br>
② ユーザーは、認証が完了することで、利用可能となる。
* ユーザー認証機能：ユーザーは、入力したユーザー名とパスワードを事前にシステム内で定めた固定値と照合され認証されると、ユーザー端末を使うことができる。<br><br>
    * ユーザー名：半角8-32桁、英大小数字記号から2種以上<br>
    * パスワード：半角8-32桁、英大小数字から2種以上
* ロック機能：ユーザーは、ユーザー認証を3回連続失敗でアカウントをロックアウトされる。
* 例外：認証失敗、入力不備、ユーザー名・ユーザーパスワードが異なっている場合には、エラーメッセージを表示する。

#### 入金
>① ユーザーは、ユーザー端末でチャージ金額とチャージ方法を選択して、残高に入金を行う。
* 残高表示機能：ユーザーは、残高をユーザー端末で確認できる。<br>
* チャージ機能：ユーザーは、指定した金額を残高にチャージできる。<br>
* 残高上限機能：システムは、チャージする際に残高上限（500,000円）を超えないか、確認する。
* 例外：チャージ金額が上限を超過する場合、エラーメッセージを表示する。


#### ユーザーログアウト
>① ユーザーは、ユーザー端末でログアウトできる。<br>
* ユーザーログアウト機能：ユーザーは、ユーザー端末からログアウトすることができる。

### 管理者
#### 管理者ログイン
>① 管理者は、管理者端末で管理者名と管理者パスワードを入力することで、管理者認証を行う。<br>
② 管理者は、認証が完了することで、利用可能となる。
* 管理者認証機能：管理者は、入力した管理者名と管理者パスワードを事前にシステム内で定めた固定値と照合され認証されると、管理者端末を使うことができる。<br>
    * 管理者名：固定値
    * パスワード：固定値
* 例外：認証失敗、入力不備、管理者名・管理者パスワードが異なっている場合には、エラーメッセージを表示する。

#### 注文状況（表示・更新）
>① 管理者は、管理端末で「未提供」の注文商品と注文からの経過時間をテーブルごとに閲覧できる。<br>
② 管理者は、注文商品を「未提供」から「提供済み」へ更新できる。
* 注文一覧表示機能：管理者は、ユーザーが注文した商品で、提供されていない商品を閲覧することができる。<br>
* 注文状況更新機能：管理者は、提供されていない商品を提供済みに変えることができる。<br>
* 注文経過時間機能：管理者は、それぞれのテーブルの注文の経過時間を閲覧できる。

#### 商品情報（表示・登録・更新）
>① 管理者は、管理端末で商品情報の一覧を閲覧できる。<br>
〇 管理者は、商品情報を指定のフォームに商品の情報を入力し、登録できる。<br>
〇 管理者は、商品情報を指定のフォームに商品の情報を入力し、更新できる。
* 商品情報取得・表示機能：管理者は、登録されている全商品の情報の一覧を閲覧することができる。<br>
* 商品情報追加機能：管理者は、フォームに商品情報（商品ID・画像・商品名・カテゴリ・価格・販売状況）を入力することで、追加することができる。
* 商品情報更新機能：管理者は、フォームに商品情報（画像・商品名・カテゴリ・価格・販売状況）を入力することで、更新することができる。
* 例外：認証失敗・入力不備がある場合には、エラーメッセージを表示する。

#### ユーザー情報（表示・更新）
>① 管理者は、管理者端末でユーザー情報の一覧を閲覧できる。<br>
〇 管理者は、アカウントをロックされたユーザー情報を更新できる。
* ユーザー一覧表示機能：管理者は、登録されている全ユーザー情報の一覧を閲覧することができる。<br>
* ユーザー更新機能：管理者は、選択したユーザーのユーザー状況を更新することができる。

#### 顧客ごとの注文動向分析
>① 管理者は、管理者端末で商品の注文数を閲覧できる。
* ランキング表示機能：管理者は、客層ごとに7日前（168時間前）からの売上トップ5の商品を閲覧することができる。
    * 客層<br>・**おひとり様**：大人1人<br>・**大人2人**：大人2人のみ<br>・**ファミリー**：大人1から2人 ＋ 子供1から7人<br>・**大人グループ**：大人3から8人<br>・**グループ**：大人3から7人 ＋ 子供1から5人



#### 管理者ログアウト
>① 管理者は、管理者端末でログアウトできる。<br>
* ログアウト機能：管理者は、管理端末からログアウトすることができる。

## 6. 非機能要件

### 6.1. セキュリティ 

*   **通信の暗号化**: 通信はHTTPSを用いて暗号化する。
*   **入力値の検証**: エンティティ層・コントロール層で不正な入力値を検知する。
*   **脆弱性対策**: SQLインジェクションに対して対策を行う。
*   **アカウントロック**: ユーザーおよび管理者のログインにおいて、ユーザー名とパスワードを連続して3回間違えた場合、アカウントを一時的にロックアウトする。（利用再開は管理者画面から設定可能。）
*   **セッション管理**: ログイン後、毎日00:00（JST）になった場合、セッションタイムアウトとして自動的にログアウト状態にする。
*   **データ保護**: パスワードとセキュリティーコードはハッシュ化（bcrypt）して管理する。

### 6.2. 信頼性・データ整合性 

*   **主キー制約**: 同時決済を防ぐため、決済処理における主キーでの二重書き込みを防ぐ。
*   データベースとの通信失敗、ユーザーの入力方法誤りなどのエラーが発生した場合には、その旨を画面上に通知する。

### 6.3. 運用・保守性

*   **データ管理**: 分析情報はシステム内で処理後、毎日00:00（JST）にデータ保管用のデータベースへ移行する。
*   **QRコード生成**: QRコードは、注文IDを元にJavaの外部ライブラリのZXingを使用して生成する。
*   **対応OS**: Windows11, macOS Tahoe, iOS26, Android16（各OSの最新バージョンをサポート対象とする。）
*   **対応ブラウザ**: Google Chrome最新版, Apple Safari最新版, Microsoft Edge最新版

### 6.4. 拡性性 (Extensibility)

*   **将来的な検討事項**:
    *   IPアドレスによるアクセス制限
    *   決済情報のブロックチェーン技術を用いたブロック化・分散化
    *   ユーザー端末からの注文機能
    *   クーポン等の発行による割引機能（Webアプリ活用促進のため、ユーザー端末内注文のみ使用可能とする想定）
    *   人数選択時におけるアレルギー項目・カロリー表記の追加
    *   管理画面における分析（人数構成・時間帯・天気等）の組み込み
    *   店舗の座席レイアウト形式での座席情報表示
    *   商品追加フォームにおける画像アップロード機能
